pipeline{
    agent { label 'JDK-17'}
    tools {
        jdk 'JDK-17'
        maven 'mvn'
    }
       
    triggers { pollSCM('* * * * *')}
stages{
    stage('git'){
        steps{
            git branch: 'main',
                url: 'https://github.com/spring-projects/spring-petclinic.git'              
        }
    }    
    // stage('Build Maven Project'){
    //     steps{
    //         rtMavenDeployer (
    //             id: "maven-ID",
    //             serverId: "JFROG",
    //             releaseRepo: 'qtdevops-libs-release-local',
    //             snapshotRepo: 'qtdevops-libs-snapshot-local',
    //             )
    //         rtMavenRun (
    //             tool: 'mvn',
    //             pom: 'pom.xml',
    //             goals: 'clean install',
    //             deployerId: "maven-ID",
    //             )
    //         rtPublishBuildInfo (
    //             serverId: "JFROG"
    //         )    
    //     }
    // }   
    stage('Build & sonarcube'){
        steps{
            withSonarQubeEnv('sonar_cloud'){
                sh 'mvn clean install sonar:sonar -Dsonar.organization=qtdevopssonar -Dsonar.token=6fcc9b95b9032ceb9efb2aead624b321e5948280 -Dsonar.projectkey=qtdevopssonar'
            }

        }
    } 
    stage('reporting') {
            steps {
                archiveArtifacts onlyIfSuccessful : true,
                       artifacts: '**/target/spring-*.jar'
                junit testResults: '**/target/surefire-reports/TEST-*.xml'
            }
        }   
    stage{

    }     
    }
}


    
